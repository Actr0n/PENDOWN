<meta charset="utf8"/>
<link rel="stylesheet" href="../pendown.css">
<xmp>
:::
°/*
    This file is part of the Pendown distribution.

    https://github.com/senselogic/GENESIS

    Copyright (C) 2017 Eric Pelzer (ecstatic.coder\@gmail.com)

    Pendown is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, version 3.

    Pendown is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Foobar.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
*/°

°// == LOCAL°

°// -\- IMPORTS°

¹import¹ core°.°stdc°.°stdlib °:° exit°;°
¹import¹ std°.°ascii °:° isAlpha°,° isDigit°,° isLower°,° isUpper°;°
¹import¹ std°.°conv °:° to°;°
¹import¹ std°.°file °:° readText°,° write°;°
¹import¹ std°.°stdio °:° writeln°;°
¹import¹ std°.°²string² °:° endsWith°,° indexOf°,° replace°,° startsWith°,° toLower°,° toUpper°;°

°// == GLOBAL°

°// -\- TYPES°

²class² ²²TOKEN²²
°{°
    ²dstring²
        Text°;°
    ²bool²
        StartsLine°,°
        IsSpace°,°
        IsEscaped°;°
°}°

°// ~\~°

²class² ²²LANGUAGE²²
°{°
    ²bool² IsConstant°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹ ²false²°;°
    °}°
    
    °// ~\~°
    
    ²bool² IsKeyword°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"if"²
            °||° code_token°.°Text °==° ²"else"²
            °||° code_token°.°Text °==° ²"do"²
            °||° code_token°.°Text °==° ²"while"²
            °||° code_token°.°Text °==° ²"for"²
            °||° code_token°.°Text °==° ²"switch"²
            °||° code_token°.°Text °==° ²"case"²
            °||° code_token°.°Text °==° ²"default"²
            °||° code_token°.°Text °==° ²"break"²
            °||° code_token°.°Text °==° ²"continue"²
            °||° code_token°.°Text °==° ²"return"²°;°
    °}°
    
    °// ~\~°
    
    ²bool² IsType°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹ ²false²°;°
    °}°
    
    °// ~\~°
    
    ²bool² IsQualifier°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹ ²false²°;°
    °}°
°}°

°// ~\~°

²class² ²²C_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
    ²override² ²bool² IsConstant°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"false"²
            °||° code_token°.°Text °==° ²"true"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsKeyword°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"if"²
            °||° code_token°.°Text °==° ²"else"²
            °||° code_token°.°Text °==° ²"do"²
            °||° code_token°.°Text °==° ²"while"²
            °||° code_token°.°Text °==° ²"for"²
            °||° code_token°.°Text °==° ²"switch"²
            °||° code_token°.°Text °==° ²"case"²
            °||° code_token°.°Text °==° ²"default"²
            °||° code_token°.°Text °==° ²"break"²
            °||° code_token°.°Text °==° ²"continue"²
            °||° code_token°.°Text °==° ²"return"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsType°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"void"²
            °||° code_token°.°Text °==° ²"bool"²
            °||° code_token°.°Text °==° ²"char"²
            °||° code_token°.°Text °==° ²"short"²
            °||° code_token°.°Text °==° ²"int"²
            °||° code_token°.°Text °==° ²"long"²
            °||° code_token°.°Text °==° ²"signed"²
            °||° code_token°.°Text °==° ²"unsigned"²
            °||° code_token°.°Text °==° ²"float"²
            °||° code_token°.°Text °==° ²"double"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsQualifier°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"const"²
            °||° code_token°.°Text °==° ²"register"²
            °||° code_token°.°Text °==° ²"inline"²
            °||° code_token°.°Text °==° ²"struct"²
            °||° code_token°.°Text °==° ²"union"²
            °||° code_token°.°Text °==° ²"enum"²
            °||° code_token°.°Text °==° ²"typedef"²
            °||° code_token°.°Text °==° ²"static"²°;°
    °}°
°}°

°// ~\~°

²class² ²²CPP_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
    ²override² ²bool² IsConstant°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"false"²
            °||° code_token°.°Text °==° ²"true"²
            °||° code_token°.°Text °==° ²"null"²
            °||° code_token°.°Text °==° ²"nullptr"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsKeyword°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"if"²
            °||° code_token°.°Text °==° ²"else"²
            °||° code_token°.°Text °==° ²"do"²
            °||° code_token°.°Text °==° ²"while"²
            °||° code_token°.°Text °==° ²"for"²
            °||° code_token°.°Text °==° ²"switch"²
            °||° code_token°.°Text °==° ²"case"²
            °||° code_token°.°Text °==° ²"default"²
            °||° code_token°.°Text °==° ²"break"²
            °||° code_token°.°Text °==° ²"continue"²
            °||° code_token°.°Text °==° ²"return"²
            °||° code_token°.°Text °==° ²"try"²
            °||° code_token°.°Text °==° ²"catch"²
            °||° code_token°.°Text °==° ²"throw"²
            °||° code_token°.°Text °==° ²"using"² 
            °||° code_token°.°Text °==° ²"namespace"² 
            °||° code_token°.°Text °==° ²"new"²
            °||° code_token°.°Text °==° ²"delete"²
            °||° code_token°.°Text °==° ²"this"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsType°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"void"²
            °||° code_token°.°Text °==° ²"bool"²
            °||° code_token°.°Text °==° ²"char"²
            °||° code_token°.°Text °==° ²"short"²
            °||° code_token°.°Text °==° ²"int"²
            °||° code_token°.°Text °==° ²"long"²
            °||° code_token°.°Text °==° ²"signed"²
            °||° code_token°.°Text °==° ²"unsigned"²
            °||° code_token°.°Text °==° ²"float"²
            °||° code_token°.°Text °==° ²"double"²
            °||° code_token°.°Text °==° ²"auto"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsQualifier°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"const"²
            °||° code_token°.°Text °==° ²"mutable"²
            °||° code_token°.°Text °==° ²"virtual"²
            °||° code_token°.°Text °==° ²"volatile"²
            °||° code_token°.°Text °==° ²"register"²
            °||° code_token°.°Text °==° ²"explicit"²
            °||° code_token°.°Text °==° ²"friend"²
            °||° code_token°.°Text °==° ²"inline"²
            °||° code_token°.°Text °==° ²"template"²
            °||° code_token°.°Text °==° ²"typename"²
            °||° code_token°.°Text °==° ²"class"²
            °||° code_token°.°Text °==° ²"struct"²
            °||° code_token°.°Text °==° ²"union"²
            °||° code_token°.°Text °==° ²"enum"²
            °||° code_token°.°Text °==° ²"typedef"²
            °||° code_token°.°Text °==° ²"static"²
            °||° code_token°.°Text °==° ²"public"²
            °||° code_token°.°Text °==° ²"protected"²
            °||° code_token°.°Text °==° ²"private"²
            °||° code_token°.°Text °==° ²"override"²
            °||° code_token°.°Text °==° ²"final"²°;°
    °}°
°}°

°// ~\~°

²class² ²²CSHARP_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
°}°

°// ~\~°

²class² ²²D_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
    ²override² ²bool² IsConstant°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"false"²
            °||° code_token°.°Text °==° ²"true"²
            °||° code_token°.°Text °==° ²"null"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsKeyword°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"if"²
            °||° code_token°.°Text °==° ²"else"²
            °||° code_token°.°Text °==° ²"do"²
            °||° code_token°.°Text °==° ²"while"²
            °||° code_token°.°Text °==° ²"for"²
            °||° code_token°.°Text °==° ²"foreach"² 
            °||° code_token°.°Text °==° ²"switch"²
            °||° code_token°.°Text °==° ²"case"²
            °||° code_token°.°Text °==° ²"default"²
            °||° code_token°.°Text °==° ²"break"²
            °||° code_token°.°Text °==° ²"continue"²
            °||° code_token°.°Text °==° ²"return"²
            °||° code_token°.°Text °==° ²"try"²
            °||° code_token°.°Text °==° ²"catch"²
            °||° code_token°.°Text °==° ²"throw"²
            °||° code_token°.°Text °==° ²"new"²
            °||° code_token°.°Text °==° ²"delete"²
            °||° code_token°.°Text °==° ²"import"² 
            °||° code_token°.°Text °==° ²"this"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsType°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"void"²
            °||° code_token°.°Text °==° ²"bool"²
            °||° code_token°.°Text °==° ²"char"²
            °||° code_token°.°Text °==° ²"wchar"²
            °||° code_token°.°Text °==° ²"dchar"²
            °||° code_token°.°Text °==° ²"ubyte"²
            °||° code_token°.°Text °==° ²"byte"²
            °||° code_token°.°Text °==° ²"ushort"²
            °||° code_token°.°Text °==° ²"short"²
            °||° code_token°.°Text °==° ²"uint"²
            °||° code_token°.°Text °==° ²"int"²
            °||° code_token°.°Text °==° ²"ulong"²
            °||° code_token°.°Text °==° ²"long"²
            °||° code_token°.°Text °==° ²"float"²
            °||° code_token°.°Text °==° ²"double"²
            °||° code_token°.°Text °==° ²"string"²
            °||° code_token°.°Text °==° ²"wstring"²
            °||° code_token°.°Text °==° ²"dstring"²
            °||° code_token°.°Text °==° ²"auto"²°;°
    °}°
    
    °// ~\~°
    
    ²override² ²bool² IsQualifier°(°
        ²²CODE_TOKEN²² code_token
        °)°
    °{°
        ¹return¹
            code_token°.°Text °==° ²"class"²
            °||° code_token°.°Text °==° ²"struct"²
            °||° code_token°.°Text °==° ²"union"²
            °||° code_token°.°Text °==° ²"enum"²
            °||° code_token°.°Text °==° ²"public"²
            °||° code_token°.°Text °==° ²"protected"²
            °||° code_token°.°Text °==° ²"private"²
            °||° code_token°.°Text °==° ²"override"²
            °||° code_token°.°Text °==° ²"final"²°;°
    °}°
°}°

°// ~\~°

²class² ²²JAVA_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
°}°

°// ~\~°

²class² ²²JAVASCRIPT_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
°}°

°// ~\~°

²class² ²²TYPESCRIPT_LANGUAGE²² °:° ²²LANGUAGE²²
°{°
°}°

°// ~\~°

²enum² ²²CODE_TOKEN_TYPE²²
°{°
    None°,°
    ShortComment°,°
    LongComment°,°
    String°,°
    Number°,°
    Constant°,°
    LowerCaseIdentifier°,°
    UpperCaseIdentifier°,°
    MinorCaseIdentifier°,°
    MajorCaseIdentifier°,°
    Identifier°,°
    Keyword°,°
    Type°,°
    Qualifier°,°
    Pragma°,°
    Operator°,°
    Separator°,°
    Delimiter°,°
    Special°,°
    Spacing°,°
    Count
°}°

°// ~\~°

²class² ²²CODE_TOKEN²²
°{°
    °// -\- ATTRIBUTES°

    ²²CODE_TOKEN_TYPE²²
        Type°;°
    ²dstring²
        Text°;°
°}°

°// ~\~°

²class² ²²CODE²²
°{°
    ²²LANGUAGE²²
        Language°;°
    ²²CODE_TOKEN²²°[]°
        TokenArray°;°
    ²dstring²°[° ²²CODE_TOKEN_TYPE²²°.°Count °]°
        ColorPrefixArray°,°
        ColorSuffixArray°;°
        
    °// ~\~°
        
    ¹this¹°(°
        ²string² file_path
        °)°
    °{°
        SetLanguage°(° file_path °)°°;°
        
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°ShortComment °]° °=° ²"\°"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°LongComment °]° °=° ²"\°"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°String °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Number °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Constant °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°LowerCaseIdentifier °]° °=° ²""²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°UpperCaseIdentifier °]° °=° ²"\²\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°MinorCaseIdentifier °]° °=° ²""²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°MajorCaseIdentifier °]° °=° ²""²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Identifier °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Keyword °]° °=° ²"\¹"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Type °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Qualifier °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Pragma °]° °=° ²"\²"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Operator °]° °=° ²"\°"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Separator °]° °=° ²"\°"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Delimiter °]° °=° ²"\°"²°;°
        ColorPrefixArray°[° ²²CODE_TOKEN_TYPE²²°.°Special °]° °=° ²"\°"²°;°
        
        ColorSuffixArray °=° ColorPrefixArray°;°
    °}°
    
    °// ~\~°
    
    ²void² SetLanguage°(°
        ²string² file_path
        °)°
    °{°
        ¹if¹ °(° LanguageName °==° ²"c"²
             °||° file_path°.°endsWith°(° ²".c"² °)°
             °||° file_path°.°endsWith°(° ²".h"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²C_LANGUAGE²²°;°
        °}°
        ¹else¹ ¹if¹ °(° LanguageName °==° ²"cpp"²
                 °||° file_path°.°endsWith°(° ²".cxx"² °)°
                 °||° file_path°.°endsWith°(° ²".cpp"² °)°
                 °||° file_path°.°endsWith°(° ²".hpp"² °)°
                 °||° file_path°.°endsWith°(° ²".hxx"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²CPP_LANGUAGE²²°;°
        °}°
        ¹else¹ ¹if¹ °(° LanguageName °==° ²"csharp"²
                  °||° file_path°.°endsWith°(° ²".cs"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²CSHARP_LANGUAGE²²°;°
        °}°
        ¹else¹ ¹if¹ °(° LanguageName °==° ²"d"²
                  °||° file_path°.°endsWith°(° ²".d"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²D_LANGUAGE²²°;°
        °}°
        ¹else¹ ¹if¹ °(° LanguageName °==° ²"java"²
                  °||° file_path°.°endsWith°(° ²".java"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²JAVA_LANGUAGE²²°;°
        °}°
        ¹else¹ ¹if¹ °(° LanguageName °==° ²"javascript"²
                  °||° file_path°.°endsWith°(° ²".js"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²JAVASCRIPT_LANGUAGE²²°;°
        °}°
        ¹else¹ ¹if¹ °(° LanguageName °==° ²"typescript"²
                  °||° file_path°.°endsWith°(° ²".ts"² °)° °)°
        °{°
            Language °=° ¹new¹ ²²TYPESCRIPT_LANGUAGE²²°;°
        °}°
        ¹else¹
        °{°
            Language °=° ¹new¹ ²²LANGUAGE²²°;°
        °}°
    °}°
    
    °// ~\~°
        
    ²void² SetTokenArray°(°
        ²dstring² text
        °)°
    °{°
        ²dchar²
            character°,°
            delimiter_character°,°
            next_character°;°
        ²long²
            character_index°;°
        ²²CODE_TOKEN²²
            code_token°;°
            
        text °=° text°.°replace°(° ²"\\r"²°,° ²""² °)°°.°replace°(° ²"\\t"²°,° ²"    "² °)°°;°
    
        ¹if¹ °(° °\!°text°.°endsWith°(° ²"\\n"² °)° °)°
        °{°
            text °~=° ²"\\n"²°;°
        °}°

        TokenArray °=° °[]°°;°

        code_token °=° ²null²°;°
        delimiter_character °=° ²0²°;°

        ¹for¹ °(° character_index °=° ²0²°;°
              character_index °&lt;=° text°.°length°;°
              °+\+°character_index °)°
        °{°
            ¹if¹ °(° character_index °&lt;° text°.°length °)°
            °{°
                character °=° text°[° character_index °]°°;°
            °}°
            ¹else¹
            °{°
                character °=° ²0²°;°
            °}°

            ¹if¹ °(° character_index °+° ²1² °&lt;° text°.°length °)°
            °{°
                next_character °=° text°[° character_index °+° ²1² °]°°;°
            °}°
            ¹else¹
            °{°
                next_character °=° ²0²°;°
            °}°

            ¹if¹ °(° code_token °\!°is ²null² °)°
            °{°
                ¹if¹ °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°String °)°
                °{°
                    ¹if¹ °(° character °==° delimiter_character °)°
                    °{°
                        code_token°.°Text °~=° character°;°

                        code_token °=° ²null²°;°
                        character °=° ²0²°;°
                    °}°
                    ¹else¹ ¹if¹ °(° character °==° ²'\\\\'² °)°
                    °{°
                        code_token°.°Text °~=° character°;°
                        code_token°.°Text °~=° next_character°;°

                        character °=° ²0²°;°

                        °+\+°character_index°;°
                    °}°
                    ¹else¹
                    °{°
                        code_token°.°Text °~=° character°;°
                    °}°
                °}°
                ¹else¹ ¹if¹ °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°ShortComment °)°
                °{°
                    ¹if¹ °(° character °==° ²'\\r'²
                         °||° character °==° ²'\\n'² °)°
                    °{°
                        code_token °=° ²null²°;°
                    °}°
                    ¹else¹
                    °{°
                        code_token°.°Text °~=° character°;°
                    °}°
                °}°
                ¹else¹ ¹if¹ °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°LongComment °)°
                °{°
                    ¹if¹ °(° character °==° ²'*'²
                         °&&° next_character °==° ²'/'² °)°
                    °{°
                        code_token°.°Text °~=° ²"*/"²°;°

                        code_token °=° ²null²°;°
                        character °=° ²0²°;°

                        °+\+°character_index°;°
                    °}°
                    ¹else¹
                    °{°
                        code_token°.°Text °~=° character°;°
                    °}°
                °}°
                ¹else¹ ¹if¹ °(° °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°Number
                            °&&° °(° character°.°isDigit°()°
                                 °||° °(° character °==° ²'.'² °&&° next_character°.°isDigit°()° °)°
                                 °||° character°.°isAlpha°()° °)° °)°
                          °||° °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°Identifier
                               °&&° °(° character°.°isAlpha°()°
                                    °||° character°.°isDigit°()°
                                    °||° character °==° ²'_'² °)° °)°
                          °||° °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°Operator
                               °&&° ²"~+-*/%^$&|?:\!=&lt;&gt;\#"²°.°indexOf°(° character °)° °&gt;=° ²0² °)° °)°
                °{°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹
                °{°
                    ¹if¹ °(° code_token°.°Type °==° ²²CODE_TOKEN_TYPE²²°.°Identifier °)°
                    °{°
                        ¹if¹ °(° Language°.°IsConstant°(° code_token °)° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Constant°;°
                        °}°
                        ¹else¹ ¹if¹ °(° Language°.°IsKeyword°(° code_token °)° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Keyword°;°
                        °}°
                        ¹else¹ ¹if¹ °(° Language°.°IsType°(° code_token °)° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Type°;°
                        °}°
                        ¹else¹ ¹if¹ °(° Language°.°IsQualifier°(° code_token °)° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Qualifier°;°
                        °}°
                        ¹else¹ ¹if¹ °(° code_token°.°Text°.°startsWith°(° ²'\#'² °)° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Pragma°;°
                        °}°
                        ¹else¹ ¹if¹ °(° code_token°.°Text °==° code_token°.°Text°.°toLower°()° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°LowerCaseIdentifier°;°
                        °}°
                        ¹else¹ ¹if¹ °(° code_token°.°Text °==° code_token°.°Text°.°toUpper°()°
                                  °&&° code_token°.°Text°.°length °&gt;=° ²2² °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°UpperCaseIdentifier°;°
                        °}°
                        ¹else¹ ¹if¹ °(° code_token°.°Text°[° ²0² °]°°.°isLower°()° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°MinorCaseIdentifier°;°
                        °}°
                        ¹else¹ ¹if¹ °(° code_token°.°Text°[° ²0² °]°°.°isUpper°()° °)°
                        °{°
                            code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°MajorCaseIdentifier°;°
                        °}°
                    °}°

                    code_token °=° ²null²°;°
                °}°
            °}°

            ¹if¹ °(° code_token is ²null²
                 °&&° character °\!=° ²0² °)°
            °{°
                code_token °=° ¹new¹ ²²CODE_TOKEN²²°;°

                ¹if¹ °(° character °==° ²'/'²
                          °&&° next_character °==° ²'/'² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°ShortComment°;°
                    code_token°.°Text °=° ²"//"²°;°

                    °+\+°character_index°;°
                °}°
                ¹else¹ ¹if¹ °(° character °==° ²'/'²
                          °&&° next_character °==° ²'*'² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°LongComment°;°
                    code_token°.°Text °=° ²"/*"²°;°

                    °+\+°character_index°;°
                °}°
                ¹else¹ ¹if¹ °(° character °==° ²'\\''²
                     °||° character °==° ²'\\"'²
                     °||° character °==° ²'\`'² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°String°;°
                    code_token°.°Text °~=° character°;°

                    delimiter_character °=° character°;°
                °}°
                ¹else¹ ¹if¹ °(° character°.°isDigit°()°
                          °||° °(° character °==° ²'-'²
                               °&&°  next_character°.°isDigit°()° °)° °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Number°;°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹ ¹if¹ °(° character°.°isAlpha°()°
                          °||° character °==° ²'_'²
                          °||° °(° character °==° ²'\#'² °&&° next_character°.°isAlpha°()° °)° °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Identifier°;°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹ ¹if¹ °(° ²"~+-*/%^$&|\!=&lt;&gt;\#"²°.°indexOf°(° character °)° °&gt;=° ²0² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Operator°;°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹ ¹if¹ °(° ²".,;"²°.°indexOf°(° character °)° °&gt;=° ²0² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Separator°;°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹ ¹if¹ °(° ²"()[]{}"²°.°indexOf°(° character °)° °&gt;=° ²0² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Delimiter°;°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹ ¹if¹ °(° ²" \\t\\r\\n"²°.°indexOf°(° character °)° °&gt;=° ²0² °)°
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Spacing°;°
                    code_token°.°Text °~=° character°;°
                °}°
                ¹else¹
                °{°
                    code_token°.°Type °=° ²²CODE_TOKEN_TYPE²²°.°Special°;°
                    code_token°.°Text °~=° character°;°
                °}°

                TokenArray °~=° code_token°;°

                ¹if¹ °(° code_token°.°Type °&gt;=° ²²CODE_TOKEN_TYPE²²°.°Separator °)°
                °{°
                    code_token °=° ²null²°;°
                °}°
            °}°
        °}°
    °}°

    °// ~\~°

    ²void² EscapeSpecialCharacters°(°
        °)°
    °{°
        ²dchar²
            prior_character°;°
        ²dstring²
            token_text°;°

        ¹foreach¹ °(° ref token°;° TokenArray °)°
        °{°
            token_text °=° ²""²°;°
            prior_character °=° ²0²°;°

            ¹foreach¹ °(° character°;° token°.°Text °)°
            °{°
                ¹if¹ °(° character °==° ²'&lt;'² °)°
                °{°
                    token_text °~=° ²"&lt;"²°;°
                °}°
                ¹else¹ ¹if¹ °(° character °==° ²'&gt;'² °)°
                °{°
                    token_text °~=° ²"&gt;"²°;°
                °}°
                ¹else¹
                °{°
                    ¹if¹ °(° ²"\\\\\`\°\¹\²\³\!\#\@"²°.°indexOf°(° character °)° °&gt;=° ²0²
                         °||° °(° ²"+-$*%^,~_{}[]:"²°.°indexOf°(° character °)° °&gt;=° ²0²
                              °&&° character °==° prior_character °)° °)°
                    °{°
                        token_text °~=° ²'\\\\'²°;°
                    °}°

                    token_text °~=° character°;°
                °}°

                prior_character °=° character°;°
            °}°

            token°.°Text °=° token_text°;°
        °}°
    °}°

    °// ~\~°

    ²void² SetText°(°
        ²dstring² text
        °)°
    °{°
        SetTokenArray°(° text °)°°;°

        EscapeSpecialCharacters°()°°;°
    °}°

    °// ~\~°

    ²dstring² GetColorizedText°(°
        °)°
    °{°
        ²dstring²
            colorized_text°;°
            
        colorized_text °~=° ²":\:\:\\n"²°;°

        ¹foreach¹ °(° token_index°,° token°;° TokenArray °)°
        °{°
            ¹if¹ °(° token_index °==° ²0²
                 °||° token°.°Type °\!=° TokenArray°[° token_index °-° ²1² °]°°.°Type °)°
            °{°
                colorized_text °~=° ColorPrefixArray°[° token°.°Type °]°°;°
            °}°

            colorized_text °~=° token°.°Text°;°

            ¹if¹ °(° token_index °==° TokenArray°.°length °-° ²1²
                 °||° token°.°Type °\!=° TokenArray°[° token_index °+° ²1² °]°°.°Type °)°
            °{°
                colorized_text °~=° ColorSuffixArray°[° token°.°Type °]°°;°
            °}°
        °}°
        
        colorized_text °~=° ²":\:\:\\n"²°;°

        ¹return¹ colorized_text°;°
    °}°
°}°

°// -\- VARIABLES°

²bool²
    ColorizeOptionIsEnabled°,°
    ProcessOptionIsEnabled°,°
    ScriptOptionIsEnabled°,°
    StyleOptionIsEnabled°;°
²string²
    InputFilePath°,°
    LanguageName°,°
    OutputFilePath°,°
    ScriptFolderPath°,°
    StyleFolderPath°;°

°// -\- FUNCTIONS°

²void² PrintError°(°
    ²string² message
    °)°
°{°
    writeln°(° ²"*\*\* ERROR : "²°,° message °)°°;°
°}°

°// ~\~°

²void² Abort°(°
    ²string² message
    °)°
°{°
    PrintError°(° message °)°°;°

    exit°(° ²-1² °)°°;°
°}°

°// ~\~°

²dchar² charAt°(°
    ²dstring² text°,°
    ²long² character_index
    °)°
°{°
    ¹return¹ text°[° character_index °]°°;°
°}°

°// ~\~°

²dstring² slice°(°
    ²dstring² text°,°
    ²long² first_character_index°,°
    ²long² post_character_index
    °)°
°{°
    ¹if¹ °(° first_character_index °&lt;° ²0² °)°
    °{°
        first_character_index °+=° text°.°length°;°
    °}°
    
    ¹if¹ °(° post_character_index °&lt;° ²0² °)°
    °{°
        post_character_index °+=° text°.°length°;°
    °}°
    
    ¹if¹ °(° first_character_index °&gt;° text°.°length °)°
    °{°
        first_character_index °=° text°.°length°;°
    °}°
    
    ¹if¹ °(° post_character_index °&gt;° text°.°length °)°
    °{°
        post_character_index °=° text°.°length°;°
    °}°
    
    
    ¹return¹ text°[° first_character_index °..° post_character_index °]°°;°
°}°

°// ~\~°

²void² splice°(° ²²ELEMENT²² °)(°
    ref ²²ELEMENT²²°[]° element_array°,°
    ²long² element_index°,°
    ²long² element_count°,°
    ²²ELEMENT²² element
    °)°
°{°
    element_array °=° element_array°[° ²0² °..° element_index °]° °~° element °~° element_array°[° element_index °+° element_count °..° °$° °]°°;°
°}°

°// ~\~°

²void² push°(° ²²ELEMENT²² °)(°
    ref ²²ELEMENT²²°[]° element_array°,°
    ²²ELEMENT²² element
    °)°
°{°
    element_array °~=° element°;°
°}°

°// ~\~°

²²ELEMENT²² pop°(° ²²ELEMENT²² °)(°
    ref ²²ELEMENT²²°[]° element_array
    °)°
°{°
    ²²ELEMENT²²
        element°;°

    element °=° element_array°[° °$° °-° ²1² °]°°;°

    element_array °=° element_array°[° ²0² °..° °$° °-° ²1² °]°°;°

    ¹return¹ element°;°
°}°

°// ~\~°

²bool² IsHexadecimalCharacter°(°
    ²dchar² character
    °)°
°{°
    ¹return¹
        °(° character °&gt;=° ²'0'² °&&° character °&lt;=° ²'9'² °)°
        °||° °(° character °&gt;=° ²'a'² °&&° character °&lt;=° ²'f'² °)°
        °||° °(° character °&gt;=° ²'A'² °&&° character °&lt;=° ²'F'² °)°°;°
°}°

°// ~\~°

²²TOKEN²²°[]° GetTokenArray°(°
    ²dstring² text
    °)°
°{°
    ²bool²
        it_is_in_a°,°
        it_is_in_b°,°
        it_is_in_blockquote°,°
        it_is_in_black_span°,°
        it_is_in_blue_span°,°
        it_is_in_box_div°,°
        it_is_in_center_div°,°
        it_is_in_cyan_span°,°
        it_is_in_frame_div°,°
        it_is_in_gray_span°,°
        it_is_in_green_span°,°
        it_is_in_i°,°
        it_is_in_left_div°,°
        it_is_in_mark_span°,°
        it_is_in_orange_span°,°
        it_is_in_pink_span°,°
        it_is_in_pre°,°
        it_is_in_red_span°,°
        it_is_in_right_div°,°
        it_is_in_strike°,°
        it_is_in_sup°,°
        it_is_in_sub°,°
        it_is_in_table°,°
        it_is_in_u°,°
        token_starts_line°;°
    ²dstring²
        color°,°
        closing_tag°,°
        url°;°
    ²long²
        character_index°;°
    ²²TOKEN²²
        closing_token°,°
        token°;°
    ²²TOKEN²²°[]°
        token_array°;°
        
    °// ~\~ °
    
    ²void² ParseColor°(°
        °)°
    °{°
        color °=° ²""²°;°
        
        ¹if¹ °(° character_index °+° ²3² °&lt;° text°.°length
             °&&° IsHexadecimalCharacter°(° text°.°charAt°(° character_index °)° °)°
             °&&° IsHexadecimalCharacter°(° text°.°charAt°(° character_index °+° ²1² °)° °)°
             °&&° IsHexadecimalCharacter°(° text°.°charAt°(° character_index °+° ²2² °)° °)° °)°
        °{°
            ¹if¹ °(° text°.°charAt°(° character_index °+° ²3² °)° °==° ²'\\\\'² °)°
            °{°
                color °=° text°.°slice°(° character_index°,° character_index °+° ²3² °)°°;°
                
                character_index °+=° ²4²°;°
            °}°
            ¹else¹ ¹if¹ °(° character_index °+° ²3² °&lt;° text°.°length
                      °&&° IsHexadecimalCharacter°(° text°.°charAt°(° character_index °+° ²3² °)° °)°
                      °&&° IsHexadecimalCharacter°(° text°.°charAt°(° character_index °+° ²4² °)° °)°
                      °&&° IsHexadecimalCharacter°(° text°.°charAt°(° character_index °+° ²5² °)° °)°
                      °&&° text°.°charAt°(° character_index °+° ²6² °)° °==° ²'\\\\'² °)°
            °{°
                color °=° text°.°slice°(° character_index°,° character_index °+° ²6² °)°°;°
                
                character_index °+=° ²7²°;°
            °}°
        °}°
    °}°
    
    °// ~\~°

    token_array °=° °[]°°;°
    token_starts_line °=° ²true²°;°

    closing_tag °=° ²""²°;°

    it_is_in_pre °=° ²false²°;°
    it_is_in_table °=° ²false²°;°
    it_is_in_blockquote °=° ²false²°;°
    it_is_in_frame_div °=° ²false²°;°
    it_is_in_box_div °=° ²false²°;°
    it_is_in_mark_span °=° ²false²°;°
    it_is_in_u °=° ²false²°;°
    it_is_in_left_div °=° ²false²°;°
    it_is_in_center_div °=° ²false²°;°
    it_is_in_right_div °=° ²false²°;°
    it_is_in_b °=° ²false²°;°
    it_is_in_i °=° ²false²°;°
    it_is_in_sup °=° ²false²°;°
    it_is_in_sub °=° ²false²°;°
    it_is_in_strike °=° ²false²°;°
    it_is_in_black_span °=° ²false²°;°
    it_is_in_cyan_span °=° ²false²°;°
    it_is_in_orange_span °=° ²false²°;°
    it_is_in_green_span °=° ²false²°;°
    it_is_in_gray_span °=° ²false²°;°
    it_is_in_pink_span °=° ²false²°;°
    it_is_in_red_span °=° ²false²°;°
    it_is_in_blue_span °=° ²false²°;°
    it_is_in_a °=° ²false²°;°

    character_index °=° ²0²°;°

    ¹while¹ °(° character_index °&lt;° text°.°length °)°
    °{°
        token °=° ¹new¹ ²²TOKEN²²°()°°;°
        token°.°StartsLine °=° token_starts_line°;°
        token_starts_line °=° ²false²°;°

        ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\\\\'²
             °&&° character_index °+° ²1² °&lt;° text°.°length °)°
        °{°
            token°.°Text °=° text°.°charAt°(° character_index °+° ²1² °)°°.°to°\!°²dstring²°()°°;°
            token°.°IsEscaped °=° ²true²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\`'² °)°
        °{°
            °+\+°character_index°;°

            ¹while¹ °(° character_index °&lt;° text°.°length °)°
            °{°
                ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\`'² °)°
                °{°
                    °+\+°character_index°;°

                    ¹break¹°;°
                °}°
                ¹else¹
                °{°
                    token°.°Text °~=° text°.°charAt°(° character_index °)°°;°

                    °+\+°character_index°;°
                °}°
            °}°

            token°.°Text °=° token°.°Text°.°replace°(° ²"&lt;"²°,° ²"&lt;"² °)°°.°replace°(° ²"&gt;"²°,° ²"&gt;"² °)°°;°
            token°.°IsEscaped °=° ²true²°;°
        °}°
        ¹else¹ ¹if¹ °(° token°.°StartsLine
                  °&&° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\! "² °)°
        °{°
            token°.°Text °=° ²"&lt;h1&gt;"²°;°
            closing_tag °=° ²"&lt;/h1&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° token°.°StartsLine
                  °&&° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"\!\! "² °)°
        °{°
            token°.°Text °=° ²"&lt;h2&gt;"²°;°
            closing_tag °=° ²"&lt;/h2&gt;"²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° token°.°StartsLine
                  °&&° text°.°slice°(° character_index°,° character_index °+° ²4² °)° °==° ²"\!\!\! "² °)°
        °{°
            token°.°Text °=° ²"&lt;h3&gt;"²°;°
            closing_tag °=° ²"&lt;/h3&gt;"²°;°

            character_index °+=° ²4²°;°
        °}°
        ¹else¹ ¹if¹ °(° token°.°StartsLine
                  °&&° text°.°slice°(° character_index°,° character_index °+° ²5² °)° °==° ²"\!\!\!\! "² °)°
        °{°
            token°.°Text °=° ²"&lt;h4&gt;"²°;°
            closing_tag °=° ²"&lt;/h4&gt;"²°;°

            character_index °+=° ²5²°;°
        °}°
        ¹else¹ ¹if¹ °(° token°.°StartsLine
                  °&&° text°.°slice°(° character_index°,° character_index °+° ²6² °)° °==° ²"\!\!\!\!\! "² °)°
        °{°
            token°.°Text °=° ²"&lt;h5&gt;"²°;°
            closing_tag °=° ²"&lt;/h5&gt;"²°;°

            character_index °+=° ²6²°;°
        °}°
        ¹else¹ ¹if¹ °(° token°.°StartsLine
                  °&&° text°.°slice°(° character_index°,° character_index °+° ²7² °)° °==° ²"\!\!\!\!\!\! "² °)°
        °{°
            token°.°Text °=° ²"&lt;h6&gt;"²°;°
            closing_tag °=° ²"&lt;/h6&gt;"²°;°

            character_index °+=° ²7²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"-\-\-"² °)°
        °{°
            token°.°Text °=° ²"&lt;hr/&gt;"²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'§'² °)°
        °{°
            token°.°Text °=° ²"&lt;br/&gt;"²°;°

            °+\+°character_index°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²4² °)° °==° ²"[\[\[\["² °)°
        °{°
            token°.°Text °=° ²"&lt;img src=\\""²°;°

            character_index °+=° ²4²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²4² °)° °==° ²"]\]\]\]"² °)°
        °{°
            token°.°Text °=° ²"\\" class=\\"large\\"/&gt;"²°;°

            character_index °+=° ²4²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"[\[\["² °)°
        °{°
            token°.°Text °=° ²"&lt;img src=\\""²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"]\]\]"² °)°
        °{°
            token°.°Text °=° ²"\\" class=\\"medium\\"/&gt;"²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"[\["² °)°
        °{°
            token°.°Text °=° ²"&lt;img src=\\""²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"]\]"² °)°
        °{°
            token°.°Text °=° ²"\\"/&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²":\:\:"² °)°
        °{°
            it_is_in_pre °=° °\!°it_is_in_pre°;°

            token°.°Text °=° it_is_in_pre °?° ²"&lt;pre&gt;"² °:° ²"&lt;/pre&gt;"²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"%\%\%"² °)°
        °{°
            it_is_in_table °=° °\!°it_is_in_table°;°

            token°.°Text °=° it_is_in_table °?° ²"&lt;table&gt;"² °:° ²"&lt;/table&gt;"²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"&gt;&gt;&gt;"² °)°
        °{°
            it_is_in_blockquote °=° °\!°it_is_in_blockquote°;°

            character_index °+=° ²3²°;°
            
            ¹if¹ °(° it_is_in_blockquote °)°
            °{°
                ParseColor°()°°;°
                
                ¹if¹ °(° color °==° ²""² °)°
                °{°
                    token°.°Text °=° ²"&lt;blockquote&gt;"²°;°
                °}°
                ¹else¹
                °{°
                    token°.°Text °=° ²"&lt;blockquote style=\\"border-color:\#"² °~° color °~° ²"\\"&gt;"²°;°
                °}°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;/blockquote&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"+\+\+"² °)°
        °{°
            it_is_in_frame_div °=° °\!°it_is_in_frame_div°;°

            character_index °+=° ²3²°;°
            
            ¹if¹ °(° it_is_in_frame_div °)°
            °{°
                ParseColor°()°°;°
                
                ¹if¹ °(° color °==° ²""² °)°
                °{°
                    token°.°Text °=° ²"&lt;div class=\\"frame\\"&gt;"²°;°                    
                °}°
                ¹else¹
                °{°
                    token°.°Text °=° ²"&lt;div class=\\"frame\\" style=\\"border-color:\#"² °~° color °~° ²"\\"&gt;"²°;°
                °}°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;/div&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"\#\#\#"² °)°
        °{°
            it_is_in_box_div °=° °\!°it_is_in_box_div°;°

            character_index °+=° ²3²°;°
            
            ¹if¹ °(° it_is_in_box_div °)°
            °{°
                ParseColor°()°°;°
                
                ¹if¹ °(° color °==° ²""² °)°
                °{°
                    token°.°Text °=° ²"&lt;div class=\\"box\\"&gt;"²°;°
                °}°
                ¹else¹
                °{°
                    token°.°Text °=° ²"&lt;div class=\\"box\\" style=\\"background-color:\#"² °~° color °~° ²"\\"&gt;"²°;°
                °}°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;/div&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"{\{\{"² °)°
        °{°
            character_index °+=° ²3²°;°
            
            ParseColor°()°°;°
                    
            ¹if¹ °(° color °==° ²""² °)°
            °{°
                token°.°Text °=° ²"&lt;div class=\\"block\\"&gt;"²°;°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;div class=\\"block\\" style=\\"background-color:"² °~° color °~° ²"\\"&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²3² °)° °==° ²"}\}\}"² °)°
        °{°
            token°.°Text °=° ²"&lt;/div&gt;"²°;°

            character_index °+=° ²3²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\#\#"² °)°
        °{°
            it_is_in_mark_span °=° °\!°it_is_in_mark_span°;°
            
            character_index °+=° ²2²°;°
            
            ¹if¹ °(° it_is_in_mark_span °)°
            °{°
                ParseColor°()°°;°
                        
                ¹if¹ °(° color °==° ²""² °)°
                °{°
                    token°.°Text °=° ²"&lt;span class=\\"mark\\"&gt;"²°;°
                °}°
                ¹else¹
                °{°
                    token°.°Text °=° ²"&lt;span class=\\"mark\\" style=\\"background-color:"² °~° color °~° ²"\\"&gt;"²°;°
                °}°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;/span&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"_\_"² °)°
        °{°
            it_is_in_u °=° °\!°it_is_in_u°;°
            
            character_index °+=° ²2²°;°
            
            ¹if¹ °(° it_is_in_u °)°
            °{°
                ParseColor°()°°;°
                        
                ¹if¹ °(° color °==° ²""² °)°
                °{°
                    token°.°Text °=° ²"&lt;u&gt;"²°;°
                °}°
                ¹else¹
                °{°
                    token°.°Text °=° ²"&lt;u style=\\"text-decoration-color:\#"² °~° color °~° ²"\\"&gt;"²°;°
                °}°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;/u&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"{\{"² °)°
        °{°
            character_index °+=° ²2²°;°
            
            ParseColor°()°°;°
                    
            ¹if¹ °(° color °==° ²""² °)°
            °{°
                token°.°Text °=° ²"&lt;span style=\\"color:\#000\\"&gt;"²°;°
            °}°
            ¹else¹
            °{°
                token°.°Text °=° ²"&lt;span style=\\"color:\#"² °~° color °~° ²"\\"&gt;"²°;°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"}\}"² °)°
        °{°
            token°.°Text °=° ²"&lt;/span&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"&lt;&lt;"² °)°
        °{°
            it_is_in_left_div °=° °\!°it_is_in_left_div°;°

            token°.°Text °=° it_is_in_left_div °?° ²"&lt;div class=\\"left\\"&gt;"² °:° ²"&lt;/div&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"$\$"² °)°
        °{°
            it_is_in_center_div °=° °\!°it_is_in_center_div°;°

            token°.°Text °=° it_is_in_center_div °?° ²"&lt;div class=\\"center\\"&gt;"² °:° ²"&lt;/div&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"&gt;&gt;"² °)°
        °{°
            it_is_in_right_div °=° °\!°it_is_in_right_div°;°

            token°.°Text °=° it_is_in_right_div °?° ²"&lt;div class=\\"right\\"&gt;"² °:° ²"&lt;/div&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"*\*"² °)°
        °{°
            it_is_in_b °=° °\!°it_is_in_b°;°

            token°.°Text °=° it_is_in_b °?° ²"&lt;b&gt;"² °:° ²"&lt;/b&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"%\%"² °)°
        °{°
            it_is_in_i °=° °\!°it_is_in_i°;°

            token°.°Text °=° it_is_in_i °?° ²"&lt;i&gt;"² °:° ²"&lt;/i&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"^\^"² °)°
        °{°
            it_is_in_sup °=° °\!°it_is_in_sup°;°

            token°.°Text °=° it_is_in_sup °?° ²"&lt;sup&gt;"² °:° ²"&lt;/sup&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²",\,"² °)°
        °{°
            it_is_in_sub °=° °\!°it_is_in_sub°;°

            token°.°Text °=° it_is_in_sub °?° ²"&lt;sub&gt;"² °:° ²"&lt;/sub&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"~\~"² °)°
        °{°
            it_is_in_strike °=° °\!°it_is_in_strike°;°

            token°.°Text °=° it_is_in_strike °?° ²"&lt;strike&gt;"² °:° ²"&lt;/strike&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\°\°"²
                  °&&° °\!°it_is_in_gray_span °)°
        °{°
            it_is_in_black_span °=° °\!°it_is_in_black_span°;°

            token°.°Text °=° it_is_in_black_span °?° ²"&lt;span style=\\"color:\#000\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\¹\¹"²
                  °&&° °\!°it_is_in_pink_span °)°
        °{°
            it_is_in_cyan_span °=° °\!°it_is_in_cyan_span°;°

            token°.°Text °=° it_is_in_cyan_span °?° ²"&lt;span style=\\"color:\#0aa\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\²\²"²
                  °&&° °\!°it_is_in_red_span °)°
        °{°
            it_is_in_orange_span °=° °\!°it_is_in_orange_span°;°

            token°.°Text °=° it_is_in_orange_span °?° ²"&lt;span style=\\"color:\#f80\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\³\³"²
                  °&&° °\!°it_is_in_blue_span °)°
        °{°
            it_is_in_green_span °=° °\!°it_is_in_green_span°;°

            token°.°Text °=° it_is_in_green_span °?° ²"&lt;span style=\\"color:\#0a0\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            character_index °+=° ²2²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\°'² °)°
        °{°
            it_is_in_gray_span °=° °\!°it_is_in_gray_span°;°

            token°.°Text °=° it_is_in_gray_span °?° ²"&lt;span style=\\"color:\#888\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            °+\+°character_index°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\¹'² °)°
        °{°
            it_is_in_pink_span °=° °\!°it_is_in_pink_span°;°

            token°.°Text °=° it_is_in_pink_span °?° ²"&lt;span style=\\"color:\#f4a\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            °+\+°character_index°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\²'² °)°
        °{°
            it_is_in_red_span °=° °\!°it_is_in_red_span°;°

            token°.°Text °=° it_is_in_red_span °?° ²"&lt;span style=\\"color:\#f00\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            °+\+°character_index°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\³'² °)°
        °{°
            it_is_in_blue_span °=° °\!°it_is_in_blue_span°;°

            token°.°Text °=° it_is_in_blue_span °?° ²"&lt;span style=\\"color:\#00f\\"&gt;"² °:° ²"&lt;/span&gt;"²°;°

            °+\+°character_index°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²5² °)° °==° ²"&lt;pre&gt;"² °)°
        °{°
            token°.°Text °=° ²"&lt;pre&gt;"²°;°

            character_index °+=° ²5²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²6² °)° °==° ²"&lt;/pre&gt;"² °)°
        °{°
            token°.°Text °=° ²"&lt;/pre&gt;"²°;°

            character_index °+=° ²6²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\@\@"² °)°
        °{°
            it_is_in_a °=° °\!°it_is_in_a°;°

            token°.°Text °=° it_is_in_a °?° ²"&lt;a href=\\""² °:° ²"&lt;/a&gt;"²°;°

            character_index °+=° ²2²°;°

            ¹if¹ °(° it_is_in_a °)°
            °{°
                url °=° ²""²°;°

                ¹while¹ °(° character_index °&lt;° text°.°length °)°
                °{°
                    ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²' '² °)°
                    °{°
                        token°.°Text °~=° url °~° ²"\\"&gt;"²°;°

                        °+\+°character_index°;°

                        ¹break¹°;°
                    °}°
                    ¹else¹ ¹if¹ °(° text°.°slice°(° character_index°,° character_index °+° ²2² °)° °==° ²"\@\@"² °)°
                    °{°
                        it_is_in_a °=° ²false²°;°

                        token°.°Text °~=° url °~° ²"\\"&gt;"² °~° url °~° ²"&lt;/a&gt;"²°;°

                        character_index °+=° ²2²°;°

                        ¹break¹°;°
                    °}°
                    ¹else¹
                    °{°
                        url °~=° text°.°charAt°(° character_index °)°°;°

                        °+\+°character_index°;°
                    °}°
                °}°
            °}°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²' '² °)°
        °{°
            token°.°Text °=° ²" "²°;°

            °+\+°character_index°;°

            ¹while¹ °(° character_index °&lt;° text°.°length
                    °&&° text°.°charAt°(° character_index °)° °==° ²' '² °)°
            °{°
                token°.°Text °~=° ²" "²°;°

                °+\+°character_index°;°
            °}°

            token°.°IsSpace °=° ²true²°;°
        °}°
        ¹else¹ ¹if¹ °(° text°.°charAt°(° character_index °)° °==° ²'\\n'² °)°
        °{°
            ¹if¹ °(° closing_tag °\!=° ²""² °)°
            °{°
                closing_token °=° ¹new¹ ²²TOKEN²²°()°°;°
                closing_token°.°Text °=° closing_tag°;°
                closing_tag °=° ²""²°;°

                token_array°.°push°(° closing_token °)°°;°
            °}°

            token°.°Text °=° ²"\\n"²°;°
            token_starts_line °=° ²true²°;°

            °+\+°character_index°;°
        °}°
        ¹else¹
        °{°
            token°.°Text °=° text°.°charAt°(° character_index °)°°.°to°\!°²dstring²°()°°;°

            °+\+°character_index°;°
        °}°

        token_array°.°push°(° token °)°°;°
    °}°

    ¹return¹ token_array°;°
°}°

°// ~\~°

²dstring² GetListTag°(°
    ref ²²TOKEN²²°[]° token_array°,°
    ²long² token_index
    °)°
°{°
    ²²TOKEN²²
        token°;°

    ¹if¹ °(° token_index °&gt;=° ²0²
         °&&° token_index °+° ²1² °&lt;° token_array°.°length
         °&&° token_array°[° token_index °+° ²1² °]°°.°IsSpace °)°
    °{°
        token °=° token_array°[° token_index °]°°;°

        ¹if¹ °(° °\!°token°.°IsEscaped °)°
        °{°
            ¹if¹ °(° token°.°Text °==° ²"\#"² °)°
            °{°
                ¹return¹ ²"ul"²°;°
            °}°
            ¹else¹ ¹if¹ °(° token°.°Text °==° ²"\@"² °)°
            °{°
                ¹return¹ ²"ol"²°;°
            °}°
        °}°
    °}°

    ¹return¹ ²null²°;°
°}°

°// ~\~°

²void² MakeLists°(°
    ref ²²TOKEN²²°[]° token_array
    °)°
°{°
    ²bool²
        it_is_in_pre°;°
    ²dstring²
        tag°,°
        tag_token_text°;°
    ²dstring²°[]°
        tag_array°;°
    ²long²
        tag_count°,°
        tag_token_index°,°
        token_index°;°
    ²²TOKEN²²
        tag_token°,°
        token°;°

    tag_array °=° °[]°°;°

    it_is_in_pre °=° ²false²°;°

    ¹for¹ °(° token_index °=° ²0²°;°
          token_index °&lt;° token_array°.°length°;°
          °+\+°token_index °)°
    °{°
        token °=° token_array°[° token_index °]°°;°

        ¹if¹ °(° it_is_in_pre °)°
        °{°
            ¹if¹ °(° token°.°Text °==° ²"&lt;/pre&gt;"² °)°
            °{°
                it_is_in_pre °=° ²false²°;°
            °}°
        °}°
        ¹else¹
        °{°
            ¹if¹ °(° token°.°Text °==° ²"&lt;pre&gt;"² °)°
            °{°
                it_is_in_pre °=° ²true²°;°
            °}°
            ¹else¹ ¹if¹ °(° token°.°StartsLine °)°
            °{°
                tag_token_index °=° token_index°;°
                tag_token °=° token°;°
                tag_count °=° ²-1²°;°
                tag °=° ²null²°;°

                ¹if¹ °(° token°.°IsSpace °)°
                °{°
                    tag °=° GetListTag°(° token_array°,° token_index °+° ²1² °)°°;°

                    ¹if¹ °(° tag °\!°is ²null² °)°
                    °{°
                        tag_count °=° ²1² °+° °(° token°.°Text°.°length °/° ²2² °)°°;°

                        °+\+°token_index°;°

                        tag_token_index °=° token_index°;°
                        tag_token °=° token_array°[° token_index °]°°;°

                        tag_token°.°Text °=° ²""²°;°
                        token_array°[° token_index °+° ²1² °]°°.°Text °=° ²""²°;°
                    °}°
                °}°
                ¹else¹
                °{°
                    tag °=° GetListTag°(° token_array°,° token_index °)°°;°

                    ¹if¹ °(° tag °\!°is ²null² °)°
                    °{°
                        tag_count °=° ²1²°;°

                        tag_token°.°Text °=° ²""²°;°
                        token_array°[° token_index °+° ²1² °]°°.°Text °=° ²""²°;°
                    °}°
                    ¹else¹ ¹if¹ °(° tag_array°.°length °&gt;° ²0² °)°
                    °{°
                        tag_count °=° ²0²°;°
                    °}°
                °}°

                ¹if¹ °(° tag_count °&gt;=° ²0² °)°
                °{°
                    tag_token_text °=° ²""²°;°

                    ¹if¹ °(° tag_count °&gt;° tag_array°.°length °)°
                    °{°
                        ¹while¹ °(° tag_count °&gt;° tag_array°.°length °)°
                        °{°
                            tag_array°.°push°(° tag °)°°;°
                            tag_token_text °~=° ²"&lt;"² °~° tag °~° ²"&gt;&lt;li&gt;"²°;°
                        °}°
                    °}°
                    ¹else¹ ¹if¹ °(° tag_count °==° tag_array°.°length °)°
                    °{°
                        tag_token_text °~=° ²"&lt;/li&gt;&lt;li&gt;"²°;°
                    °}°
                    ¹else¹ ¹if¹ °(° tag_count °&lt;° tag_array°.°length °)°
                    °{°
                        ¹while¹ °(° tag_count °&lt;° tag_array°.°length °)°
                        °{°
                            tag_token_text °~=° ²"&lt;/li&gt;&lt;/"² °~° tag_array°.°pop°()° °~° ²"&gt;"²°;°
                        °}°

                        ¹if¹ °(° tag °\!°is ²null² °)°
                        °{°
                            tag_token_text °~=° ²"&lt;/li&gt;&lt;li&gt;"²°;°
                        °}°
                    °}°

                    ¹if¹ °(° tag_token_text °\!=° ²""² °)°
                    °{°
                        token °=° ¹new¹ ²²TOKEN²²°()°°;°
                        token°.°Text °=° tag_token_text°;°
                        token_array°.°splice°(° tag_token_index°,° ²0²°,° token °)°°;°

                        °+\+°token_index°;°
                    °}°
                °}°
            °}°
        °}°
    °}°
°}°

°// ~\~°

²void² MakeParagraphs°(°
    ref ²²TOKEN²²°[]° token_array
    °)°
°{°
    ²bool²
        it_is_in_pre°;°
    ²long²
        token_index°;°
    ²²TOKEN²²
        token°;°

    token °=° ¹new¹ ²²TOKEN²²°()°°;°
    token°.°Text °=° ²"&lt;p&gt;"²°;°
    token_array°.°splice°(° ²0²°,° ²0²°,° token °)°°;°

    it_is_in_pre °=° ²false²°;°

    ¹for¹ °(° token_index °=° ²0²°;°
          token_index °&lt;° token_array°.°length°;°
          °+\+°token_index °)°
    °{°
        token °=° token_array°[° token_index °]°°;°

        ¹if¹ °(° it_is_in_pre °)°
        °{°
            ¹if¹ °(° token°.°Text °==° ²"&lt;/pre&gt;"² °)°
            °{°
                it_is_in_pre °=° ²false²°;°
            °}°
        °}°
        ¹else¹
        °{°
            ¹if¹ °(° token°.°Text °==° ²"&lt;pre&gt;"² °)°
            °{°
                it_is_in_pre °=° ²true²°;°
            °}°
            ¹else¹ ¹if¹ °(° token°.°StartsLine
                 °&&° token°.°Text °==° ²"\\n"² °)°
            °{°
                token°.°Text °=° ²"&lt;/p&gt;&lt;p&gt;\\n"²°;°
            °}°
        °}°
    °}°

    token °=° ¹new¹ ²²TOKEN²²°()°°;°
    token°.°Text °=° ²"&lt;/p&gt;"²°;°
    token_array°.°push°(° token °)°°;°
°}°

°// ~\~°

²void² MakeTables°(°
    ref ²²TOKEN²²°[]° token_array
    °)°
°{°
    ²bool²
        it_is_in_row°,°
        it_is_in_table°;°
    ²long²
        token_index°;°
    ²²TOKEN²²
        token°;°

    it_is_in_table °=° ²false²°;°
    it_is_in_row °=° ²false²°;°

    ¹for¹ °(° token_index °=° ²0²°;°
          token_index °&lt;° token_array°.°length°;°
          °+\+°token_index °)°
    °{°
        token °=° token_array°[° token_index °]°°;°

        ¹if¹ °(° it_is_in_table °)°
        °{°
            ¹if¹ °(° token°.°Text °==° ²"&lt;/table&gt;"² °)°
            °{°
                it_is_in_table °=° ²false²°;°
            °}°
            ¹else¹ ¹if¹ °(° token°.°StartsLine °)°
            °{°
                token °=° ¹new¹ ²²TOKEN²²°()°°;°
                token°.°Text °=° ²"&lt;tr&gt;&lt;td&gt;"²°;°
                token_array°.°splice°(° token_index°,° ²0²°,° token °)°°;°
                °+\+°token_index°;°

                it_is_in_row °=° ²true²°;°
            °}°
            ¹else¹ ¹if¹ °(° token°.°Text °==° ²"|"²
                      °&&° °\!°token°.°IsEscaped °)°
            °{°
                token°.°Text °=° ²"&lt;/td&gt;&lt;td&gt;"²°;°
            °}°
            ¹else¹ ¹if¹ °(° token°.°Text °==° ²"\\n"² °)°
            °{°
                ¹if¹ °(° it_is_in_row °)°
                °{°
                    token °=° ¹new¹ ²²TOKEN²²°()°°;°
                    token°.°Text °=° ²"&lt;/td&gt;&lt;/tr&gt;"²°;°
                    token_array°.°splice°(° token_index°,° ²0²°,° token °)°°;°
                    °+\+°token_index°;°

                    it_is_in_row °=° ²false²°;°
                °}°
            °}°
        °}°
        ¹else¹
        °{°
            ¹if¹ °(° token°.°Text °==° ²"&lt;table&gt;"² °)°
            °{°
                it_is_in_table °=° ²true²°;°
            °}°
        °}°
    °}°

    token °=° ¹new¹ ²²TOKEN²²°()°°;°
    token°.°Text °=° ²"&lt;/p&gt;"²°;°
    token_array°.°push°(° token °)°°;°
°}°

°// ~\~°

²dstring² GetText°(°
    ref ²²TOKEN²²°[]° token_array
    °)°
°{°
    ²dstring²
        text°;°
    ²long²
        token_index°;°

    text °=° ²""²°;°

    ¹for¹ °(° token_index °=° ²0²°;°
          token_index °&lt;° token_array°.°length°;°
          °+\+°token_index °)°
    °{°
        text °~=° token_array°[° token_index °]°°.°Text°;°
    °}°

    ¹return¹ text°;°
°}°

°// ~\~°

²dstring² GetProcessedText°(°
    ²dstring² text
    °)°
°{°
    ²²TOKEN²²°[]°
        token_array°;°

    token_array °=° GetTokenArray°(° text °)°°;°

    MakeLists°(° token_array °)°°;°
    MakeParagraphs°(° token_array °)°°;°
    MakeTables°(° token_array °)°°;°

    ¹return¹ GetText°(° token_array °)°°;°
°}°

°// ~\~°

²void² Process°(°
    °)°
°{°
    ²dstring²
        text°;°
    ²²CODE²²
        code°;°

    text °=° InputFilePath°.°readText°()°°.°to°\!°²dstring²°()°°;°
    
    ¹if¹ °(° ColorizeOptionIsEnabled °)°
    °{°
        code °=° ¹new¹ ²²CODE²²°(° InputFilePath °)°°;°
        code°.°SetText°(° text °)°°;°
        
        text °=° code°.°GetColorizedText°()°°;°
    °}°
    
    ¹if¹ °(° ProcessOptionIsEnabled °)°
    °{°
        text °=° text°.°GetProcessedText°()°°;°
    °}°

    ¹if¹ °(° ScriptOptionIsEnabled °)°
    °{°
        text 
            °=° ²"&lt;xmp&gt;\\n"²
              °~° text
              °~° ²"&lt;/xmp&gt;\\n"²
              °~° ²"&lt;script src=\\""² °~° ScriptFolderPath°.°to°\!°²dstring²°()° °~° ²"pendown.js\\"&gt;&lt;/script&gt;\\n"²°;°
    °}°
    
    ¹if¹ °(° StyleOptionIsEnabled °)°
    °{°
        text 
            °=° ²"&lt;meta charset=\\"utf8\\"/&gt;\\n"²
              °~° ²"&lt;link rel=\\"stylesheet\\" href=\\""² °~° StyleFolderPath°.°to°\!°²dstring²°()° °~° ²"pendown.css\\"&gt;\\n"²
              °~° text°;°
    °}°

    OutputFilePath°.°write°(° text°.°to°\!°²string²°()° °)°°;°
°}°

°// ~\~°

²void² main°(°
    ²string²°[]° argument_array
    °)°
°{°
    ²string²
        option°;°
        
    argument_array °=° argument_array°[° ²1² °..° °$° °]°°;°
    
    ColorizeOptionIsEnabled °=° ²false²°;°
    ProcessOptionIsEnabled °=° ²false²°;°
    ScriptOptionIsEnabled °=° ²false²°;°
    StyleOptionIsEnabled °=° ²false²°;°
    LanguageName °=° ²""²°;°
    ScriptFolderPath °=° ²""²°;°
    StyleFolderPath °=° ²""²°;°
    
    ¹while¹ °(° argument_array°.°length °&gt;=° ²1²
            °&&° argument_array°[° ²0² °]°°.°startsWith°(° ²"-\-"² °)° °)°
    °{°
        option °=° argument_array°[° ²0² °]°°;°

        argument_array °=° argument_array°[° ²1² °..° °$° °]°°;°

        ¹if¹ °(° option °==° ²"-\-colorize"² °)°
        °{°
            ColorizeOptionIsEnabled °=° ²true²°;°
        °}°
        ¹else¹ ¹if¹ °(° option °==° ²"-\-process"² °)°
        °{°
            ProcessOptionIsEnabled °=° ²true²°;°
        °}°
        ¹else¹ ¹if¹ °(° option °==° ²"-\-script"² °)°
        °{°
            ScriptOptionIsEnabled °=° ²true²°;°
        °}°
        ¹else¹ ¹if¹ °(° option °==° ²"-\-style"² °)°
        °{°
            StyleOptionIsEnabled °=° ²true²°;°
        °}°
        ¹else¹ ¹if¹ °(° option °==° ²"-\-language"²
             °&&° argument_array°.°length °&gt;=° ²1² °)°
        °{°
            LanguageName °=° argument_array°[° ²0² °]°°;°

            argument_array °=° argument_array°[° ²1² °..° °$° °]°°;°
        °}°
        ¹else¹ ¹if¹ °(° option °==° ²"-\-path"²
             °&&° argument_array°.°length °&gt;=° ²1²
             °&&° argument_array°[° ²0² °]°°.°endsWith°(° ²'/'² °)° °)°
        °{°
            ScriptFolderPath °=° argument_array°[° ²0² °]°°;°
            StyleFolderPath °=° argument_array°[° ²0² °]°°;°

            argument_array °=° argument_array°[° ²1² °..° °$° °]°°;°
        °}°
        ¹else¹
        °{°
            Abort°(° ²"Invalid option : "² °~° option °)°°;°
        °}°
    °}°
    
    ¹if¹ °(° argument_array°.°length °==° ²2² °)°
    °{°
        InputFilePath °=° argument_array°[° ²0² °]°°;°
        OutputFilePath °=° argument_array°[° ²1² °]°°;°

        Process°()°°;°
    °}°
    ¹else¹
    °{°
        writeln°(° ²"Usage :"² °)°°;°
        writeln°(° ²"    pendown [options] input_file output_file"² °)°°;°
        writeln°(° ²"Options :"² °)°°;°
        writeln°(° ²"    -\-colorize"² °)°°;°
        writeln°(° ²"    -\-process"² °)°°;°
        writeln°(° ²"    -\-script"² °)°°;°
        writeln°(° ²"    -\-style"² °)°°;°
        writeln°(° ²"    -\-language c|cpp|csharp|d|java|javascript|typescript"² °)°°;°
        writeln°(° ²"    -\-path PENDOWN_FOLDER/"² °)°°;°
        writeln°(° ²"Examples :"² °)°°;°
        writeln°(° ²"    pendown -\-process -\-style -\-path ../ document.pd document.html"² °)°°;°
        writeln°(° ²"    pendown -\-script -\-style -\-path ../ document.pd document.html"² °)°°;°
        writeln°(° ²"    pendown -\-colorize code.d code.pd"² °)°°;°
        writeln°(° ²"    pendown -\-colorize -\-process -\-style -\-path ../ code.d code.html"² °)°°;°
        writeln°(° ²"    pendown -\-colorize -\-script -\-style -\-path ../ code.d code.html"² °)°°;°

        Abort°(° ²"Invalid arguments : "² °~° argument_array°.°to°\!°²string²°()° °)°°;°
    °}°
°}°

:::
</xmp>
<script src="../pendown.js"></script>
